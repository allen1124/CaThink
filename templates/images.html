{% extends 'head.html' %}

{% block content %}
    <div class="col-md-10 col-lg-8 col-xl-7 mx-auto mt-4 mb-4">
        <form method="GET" action="">
            <div class="form-row">
			{% if messages %}
				{% for message in messages %}
					<div class="alert alert-{{ message.tags }} alert-dismissible col-12 col-md-12" role="alert">
						<button type="button" class="close" data-dismiss="alert">&times;</button>
						{{ message }}
					</div>
				{% endfor %}
			{% endif %}
				<div class="col-12 col-md-3">
					<select class="form-control form-control-lg" name="cat" id="cat">
						<option value="">--Category--</option>
						<option value="Abstract">Abstract</option>
						<option value="Aerial">Aerial</option>
						<option value="Animals">Animals</option>
						<option value="Architecture">Architecture</option>
						<option value="Black and White">Black and White</option>
						<option value="Family">Family</option>
						<option value="Fashion">Fashion</option>
						<option value="Fine Art">Fine Art</option>
						<option value="Food">Food</option>
						<option value="Journalism">Journalism</option>
						<option value="Landscape">Landscape</option>
						<option value="Macro">Macro</option>
						<option value="Nature">Nature</option>
						<option value="Night">Night</option>
						<option value="People">People</option>
						<option value="Performing Arts">Performing Arts</option>
						<option value="Sport">Sport</option>
						<option value="Still Life">Still Life</option>
						<option value="Street, and Travel">Street, and Travel</option>
					</select>
				</div>
				<div class="input-group col-12 col-md-7">
					<div class="input-group-prepend">
						{% if request.GET.p %}
							<button class="btn btn-outline-secondary" type="button" id="search_by">Search by Photographer</button>
						{% else %}
							<button class="btn btn-outline-secondary" type="button" id="search_by">Search by Keyword</button>
						{% endif %}
					</div>
					{% if request.GET.p %}
						<input type="search" id="query" name="p" value="{{ request.GET.p }}" class="form-control form-control-lg">
					{% else %}
						<input type="search" id="query" name="q" value="{{ request.GET.q }}" class="form-control form-control-lg">
					{% endif %}
				</div>
                <div class="col-12 col-md-2">
                    <button type="submit" class="btn btn-block btn-lg btn-primary">Search</button>
                </div>
            </div>
        </form>
    </div>

    <div class="row mb-2 text-center text-lg-left ml-2 mr-2">
        {% for image in imagesList %}
            <div class="col-md-6">
                <div class="card flex-md-row mb-4 box-shadow h-md-250">
                    <div class="card-body d-flex flex-column align-items-start">
                        <div style="-ms-word-break: break-all; word-break: break-all;
                        	word-break: break-word; -webkit-hyphens: auto;
							-moz-hyphens: auto; hyphens: auto;">
							{% if image.category != None %}
								<strong class="d-inline-block mb-2 text-primary">{{ image.category }}</strong>
							{% endif %}
                            <h3 class="mb-0">
                                <a class="text-dark" href="/images/detail/{{ image.id }}">{{ image.title }}</a>
                            </h3>
                            <p class="card-text mb-auto">
                                {{ image.description|linebreaks|truncatechars:200 }}
                            </p>
                            <div class="mb-1 text-muted small">{{ image.updated }}</div>
                            <a href="/profile/detail/{{ image.user.id }}">{{ image.user.username }}</a><br>
                            <a class="small" href="#">#{{ image.tag }}</a>
                        </div>
                    </div>
                    <img class="card-img-right flex-auto d-none d-md-block" id="responsive-image" width="70%"
                         height="100%" src="{{ image.image.url }}" alt="Card image cap">
                </div>
            </div>
        {% endfor %}
    </div>
	<div class="pagination">
        <span class="step-links">
            {% if imagesList.has_previous %}
				<a href="?page=1{% if request.GET.cat %}&cat={{ request.GET.cat }}{% endif %}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.p %}&p={{ request.GET.p }}{% endif %}">&laquo; first</a>
                <a href="?page={{ imagesList.previous_page_number }}{% if request.GET.cat %}&cat={{ request.GET.cat }}{% endif %}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.p %}&p={{ request.GET.p }}{% endif %}">previous
                </a>
            {% endif %}
            <span class="current">
                Page {{ imagesList.number }} of {{ imagesList.paginator.num_pages }}.
            </span>
            {% if imagesList.has_next %}
                <a href="?page={{ imagesList.next_page_number }}{% if request.GET.cat %}&cat={{ request.GET.cat }}{% endif %}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.p %}&p={{ request.GET.p }}{% endif %}">next</a>
                <a href="?page={{ imagesList.paginator.num_pages }}{% if request.GET.cat %}&cat={{ request.GET.cat }}{% endif %}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.p %}&p={{ request.GET.p }}{% endif %}">last &raquo;</a>
            {% endif %}
        </span>
    </div>

	<script type="text/javascript">
  		document.getElementById('cat').value = "{{ request.GET.cat }}";
  		$('#search_by').click(function(e){
			$(this).text(function(_, value) {
                return value == 'Search by Keyword' ? 'Search by Photographer' : 'Search by Keyword';
            });
			if($('#query').attr('name') == 'q')
				$('#query').attr('name', 'p');
			else
			    $('#query').attr('name', 'q');
        });
	</script>
{% endblock %}